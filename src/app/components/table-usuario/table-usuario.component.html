<section class="container">
    <p-table #dt [value]="usuarios" [columns]="cols" responsiveLayout="scroll" [rows]="10"
        [globalFilterFields]="['num_empleado','country.num_empleado','representative.num_empleado','status']"
        [rows]="10" [paginator]="true" [rowsPerPageOptions]="[10,20,30]" [showCurrentPageReport]="true"
        currentPageReportTemplate="mostrando {first} a {last} de {totalRecords} entradas"
        [(selection)]="selectedProducts" [rowHover]="true" dataKey="id">


        <ng-template pTemplate="caption">
            <div class="flex justify-content-between fondo">
                <div>
                    <h1>USUARIOS REGISTRADOS</h1>
                </div>
                <div class="inline-flex">
                    
                    <button pButton pRipple label="Nuevo" icon="pi pi-plus" class="p-button-success mr-2"
                        (click)="openNew()"></button>


                    <button pButton pRipple label="Exportar" icon="pi pi-upload" class="p-button-help mr-2"
                        (click)="exportCSV()"></button>

                    <span class=" p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="onGlobalFilter(dt, $event)"
                            placeholder="Numero de Empleado" class="w-full sm:w-auto" />
                    </span>

                </div>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th>Numero de Usuario <p-sortIcon field="code"></p-sortIcon></th>
                <th>Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
                
                <th>Apellido Paterno</th>
                <th>Apellido Materno <p-sortIcon field="price"></p-sortIcon></th>
                <th>Email <p-sortIcon field=""></p-sortIcon></th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-altaEmpleado>
            <tr>
                <td style="width:14%; min-width:10rem;"><span class="p-column-title">Code</span>
                    {{altaEmpleado.num_empleado}}
                </td>
                <td style="width:14%; min-width:10rem;">
                    <span class="p-column-title">Name</span>
                    {{altaEmpleado.nombre}}
                </td>
                <td style="width:14%; min-width:10rem;"><span class="p-column-title">Image</span>
                    {{altaEmpleado.apellidoP}}
                </td>
                <td style="width:14%; min-width:8rem;">
                    <span class="p-column-title">Price</span>
                    {{altaEmpleado.apellidoM}}
                </td>
                <td style="width:14%; min-width:10rem;">
                    <span class="p-column-title">Pertenencia</span>
                    {{altaEmpleado.email}}
                </td>
                <td>
                    <div class="flex" style="padding-left:10rem;">



                        <!-- <button  pButton pRipple icon="pi pi-pencil"
                            class="p-button-rounded p-button-success mr-2"></button>-->
                        <!--<button pButton pRipple icon="pi pi-trash"
                            class="p-button-rounded p-button-warning"></button>-->
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</section>

<div class="card flex justify-content-center">

    <p-dialog header="REGISTRAR UN NUEVO USUARIO" [(visible)]="displayAddModal" [maximizable]="true"
        [style]="{height:'35vw', width: '90vw' }">
        <i>Ingresar la información basica, ubicación y área de trabajo del usuario, así como establecer los permisos y roles
            correspondientes. </i>
        <form [formGroup]="recoInfo" (ngSubmit)="addUsuario()">
            <section class="container">

                <div class="grid">

                    <div class="col-12 md:col-3">
                       
                        <label htmlFor="num_empleado">N°Empleado</label>
                            <span class="p-float-label">
                                <input class="wtexto" formControlName="num_empleado" pInputText id="num_empleado"
                                [class.is-invalid]="isFieldInvalidAndTouched('num_empleado')"   />
                                <small class="p-error" *ngIf="isFieldInvalidAndTouched('num_empleado')">Este campo es requerido</small>
                            </span>
                            
                    </div>
                    

                    <div class="col-12 md:col-3">
                        
                        <label htmlFor="nombre">Nombre</label>
                           
                                <input class="wtexto" 
                                pInputText 
                                formControlName="nombre" 
                               
                                    type="text" 
                                    id="nombre" 
                                    >
                               
                                <small *ngIf="isValidField('nombre')" class="p-error">No debe contener numeros</small>
                           
                        
                    </div>

                    <div class="col-12 md:col-3">
                        
                        <label htmlFor="apellidoP">A.Paterno</label>
                           
                                <input class="wtexto" formControlName="apellidoP" pInputText id="apellidoP"
                                    >
                            <small *ngIf="isValidField('apellidoP')" class="p-error">no valido</small>
                           
                        
                    </div>

                    <div class="col-12 md:col-3">
                        
                        <label htmlFor="apellidoM">A.Materno</label>
                          
                                <input class="wtexto" formControlName="apellidoM" pInputText id="apellidoM"
                                     >
                                <small *ngIf="isValidField('apellidoM')" class="p-error">no valido</small>
                           
                        
                    </div>

                </div>
            </section>

            <section class="container">
                <div class="grid">
                    <div class="col-12 md:col-3">
                        <label htmlFor="email">Email</label>
                                <input 
                                type="email"
                                class="wtexto" 
                                formControlName="email" 
                                pInputText 
                                id="email"
                                      >
                                <small *ngIf="isValidField('email')" class="p-error">Escribe un correo electronico valido</small>
                            
                        
                    </div>

                    <div class="col-12 md:col-3">
                            <label htmlFor="idrol">Estado</label>
                                <div>
                                    <p-dropdown formControlName="status" [options]="opcionesEstado" placeholder="estado"
                                        [showClear]="true"
                                        [class.is-invalid]="isFieldInvalidAndTouched('status')"></p-dropdown>
                                    </div>
                                    <div *ngIf="recoInfo.touched && recoInfo.invalid">
                                    
                                        <small *ngIf="isFieldInvalidAndTouched('status')" id="blErrorstatus" class="p-error">El campo Estado
                                            se encuentra vacío.</small>
                                    </div>
                    </div> 

                    <div class="col-12 md:col-3">
                        <label htmlFor="idrol">Rol</label>
                        <div>
                            <p-dropdown [options]="roles" placeholder="Seleccione un Rol" formControlName="idrol"
                                 optionLabel="descripcion_rol"
                                optionValue="idrol" [showClear]="true"
                                [class.is-invalid]="isFieldInvalidAndTouched('idrol')"></p-dropdown>
                            </div>
                            <div *ngIf="recoInfo.touched && recoInfo.invalid">
                            
                                <small *ngIf="isFieldInvalidAndTouched('idrol')" id="blErroridrol" class="p-error">El campo rol
                                    se encuentra vacío.</small>
                            </div>
                    </div>


                    <div class="col-12 md:col-3">
                        <label htmlFor="lugares">Lugar</label>
                            <p-dropdown [options]="lugares" placeholder="Seleccione un lugar" formControlName="idlugar"
                                optionLabel="ubicacion"
                                optionValue="idlugar" [showClear]="true"></p-dropdown>
                            <label htmlFor="Seleccione un lugar"></label>
                        <div *ngIf="recoInfo.touched && recoInfo.invalid">
                        
                            <small *ngIf="isFieldInvalidAndTouched('idlugar')" id="blErroridlugar" class="p-error">El campo lugar
                                se encuentra vacío.</small>
                        </div>
                    </div>
                </div>
            </section>
            <section class="container">
                <div class="grid">
                    <div class="col-12 md:col-3">
                        <label htmlFor="area">Area</label>
                            <p-dropdown [options]="area" placeholder="Seleccione un Area" formControlName="idarea"
                                 optionLabel="nombre_area"
                                optionValue="idarea" [showClear]="true"
                                 [class.is-invalid]="isFieldInvalidAndTouched('idarea')"></p-dropdown>
                            <div *ngIf="recoInfo.touched && recoInfo.invalid">
                            
                                <small *ngIf="isFieldInvalidAndTouched('idarea')" id="blErroridarea" class="p-error">El campo area
                                    se encuentra vacío.</small>
                            </div>
                    </div>
                    <div class="col-12 md:col-9">
                        <label htmlFor="password">Contraseña</label>
                            
                                <input class="wtexto" formControlName="password" pInputText id="password"
                                    autocomplete="off"
                                    [class.is-invalid]="isFieldInvalidAndTouched('password')">
                               
                        <div *ngIf="recoInfo.touched && recoInfo.invalid">
                        
                            <small *ngIf="isFieldInvalidAndTouched('password')" id="blErrorpassword" class="p-error">Contraseña no valida</small>
                        </div>
                        
                    </div>
                </div>
            </section>
        </form>
        <ng-template pTemplate="footer">
            <p-button icon="pi pi-trash" (click)="closeModal()" label="Limpiar" styleClass="p-button-text"></p-button>
            <p-button icon="pi pi-check" (click)="addUsuario()" label="Añadir" styleClass="p-button-text"></p-button>

        </ng-template>
    </p-dialog>
    <p-toast position="top-right"></p-toast>
    <app-alerta></app-alerta>
</div>